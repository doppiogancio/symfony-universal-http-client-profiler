{% extends '@WebProfiler/Profiler/layout.html.twig' %}

{% block toolbar %}
    {% set requestCount = collector.requests|length %}
    {% set totalDuration = 0 %}
    {% for entry in collector.requests %}
        {% if entry.durationMs is not null %}
            {% set totalDuration = totalDuration + entry.durationMs %}
        {% endif %}
    {% endfor %}

    {% set icon %}
        <span class="sf-toolbar-value">{{ requestCount }}</span>
    {% endset %}

    {% set text %}
        <div class="sf-toolbar-info-piece">
            <b>Requests</b>
            <span>{{ requestCount }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Total duration</b>
            <span>{{ totalDuration|number_format(2, '.', ' ') }} ms</span>
        </div>
    {% endset %}

    {{ include('@WebProfiler/Profiler/toolbar_item.html.twig', { link: profiler_url }) }}
{% endblock %}

{% block menu %}
    <span class="label">
        <span class="icon">HTTP</span>
        <strong>HTTP Profiler</strong>
    </span>
{% endblock %}

{% block panel %}
    <h2>HTTP Requests</h2>

    {% set totalRequests = collector.requests|length %}
    {% set totalDuration = 0 %}
    {% for entry in collector.requests %}
        {% if entry.durationMs is not null %}
            {% set totalDuration = totalDuration + entry.durationMs %}
        {% endif %}
    {% endfor %}

    <div class="metrics">
        <div class="metric">
            <span class="value">{{ totalRequests }}</span>
            <span class="label">Total requests</span>
        </div>
        <div class="metric">
            <span class="value">{{ totalDuration|number_format(2, '.', ' ') }} <span class="unit">ms</span></span>
            <span class="label">Total duration</span>
        </div>
    </div>

    {% if totalRequests == 0 %}
        <div class="empty">
            <p>No HTTP requests were recorded.</p>
        </div>
    {% else %}
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Method</th>
                    <th scope="col">URL</th>
                    <th scope="col">Status</th>
                    <th scope="col">Duration</th>
                    <th scope="col">Error</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in collector.requests %}
                    <tr>
                        <td>{{ entry.method }}</td>
                        <td class="break-long-words">{{ entry.url }}</td>
                        <td>{{ entry.responseStatus is not null ? entry.responseStatus : '–' }}</td>
                        <td>{{ entry.durationMs is not null ? entry.durationMs|number_format(2, '.', ' ') ~ ' ms' : '–' }}</td>
                        <td>{{ entry.error is not empty ? entry.error : '–' }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}

    <h2>CLI Sessions</h2>

    {{ include('@UniversalHttpClientProfiler/Collector/cli_sessions.html.twig', { sessions: collector.cliSessions }) }}
{% endblock %}
